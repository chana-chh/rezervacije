{% extends "templates/app.twig" %}
{% block naslov %}
<div class="row">
  <div class="col">
    <h1>
	  <i class="fas fa-file-signature text-secondary"></i>
	  Pregled ugovora
	  <strong class="text-info">{{ ugovor.broj_ugovora }}</strong>
    </h1>
  </div>
  <div class="col text-right pt-3">
    <div class="btn-group btn-group-sm">
      <button type="button" class="btn btn-secondary" onclick="window.history.back();" title="Povratak na prethodnu stranu"><i
          class="fas fa-chevron-circle-left"></i> Nazad</button>
      <a
        href="{{ path_for('termin.detalj.get', { id: ugovor.termin_id }) }}"
        class="btn btn-secondary"
        ><i class="fas fa-arrow-alt-circle-left"></i> Termin</a
      >
    </div>
  </div>
</div>
<hr />
{% endblock naslov %}
{% block sadrzaj %}
<h4 class="text-primary">
	Termin: {{ugovor.termin().datum|date()}} od {{ ugovor.termin.pocetak|date("H:i") }} do {{ ugovor.termin.kraj|date("H:i") }}
</h4>
<table class="table mb-0">
	<tr>
		<th class="w-20">Meni</th>
		<td class="w-70">{{ ugovor.meni.naziv }}</td>
		<td class="w-10 text-right">
			<a
				class="btn btn-info btn-sm"
				href="{{ path_for('meni.detalj', { id: ugovor.meni.id }) }}"
				title="Detaljni pregled odabranog menija"
			>
				<i class="fas fa-eye"></i>
			</a

		</td>
	</tr>
	<tr>
		<th><strong>Ime i prezime</strong></th>
		<td>{{ ugovor.punoIme() }}</td>
		<td></td>
	</tr>
	<tr>
		<th><strong>Telefon</strong></th>
		<td>{{ ugovor.telefon }}</td>
		<td></td>
	</tr>
	<tr>
		<th><strong>E-mail</strong></th>
		<td>
			<a href="mailto:{{ ugovor.email }}">
				{{ ugovor.email }}</td>
			</a>
		<td></td>
	</tr>
	<tr>
		<th><strong>Cena</strong></th>
		<td>{{ ugovor.iznos|number_format }}</td>
		<td></td>
	</tr>
	<tr>
		<th><strong>Posebni zahtevi</strong></th>
		<td>{{ ugovor.posebni_zahtevi }}</td>
		<td></td>
	</tr>
	<tr>
		<th><strong>Napomena</strong></th>
		<td>{{ ugovor.napomena }}</td>
		<td></td>
	</tr>
</table>

<hr>

<div class="row">
	<div class="col">
    	<h4>
			<i class="fas fa-credit-card text-secondary"></i>
			Pregled uplata
		</h4>
	</div>
	{#}
	<div class="col text-right">
		<button
			class="btn btn-primary btn-sm otvori-uplatu"
			data-toggle="modal"
			data-target="#uplataModal"
			data-id="{{ ugovor.id }}"
			title="Evidetiranje uplate"
		>
			<i class="fas fa-money-bill"></i>
			Evidetiranje uplate
		</button>
	</div>
	#}
</div>
<div class="row">
    <div class="col">
        <table class="table table-sm table-striped">
          <thead class="thead-dark">
            <tr>
              <th class="w-5">#</th>
              <th class="w-20">Datum</th>
              <th class="w-20">Iznos</th>
              <th class="w-20">Način plaćanja</th>
              <th class="w-20">Opis</th>
              <th class="w-15 text-right text-warning">
				  <i class="fas fa-cogs"></i>
			  </th>
            </tr>
          </thead>
          <tbody>
            {% for uplata in ugovor.uplate %}
            <tr>
              <th>{{ loop.index }}</th>
              <td><strong>{{ uplata.datum|date }}</strong></td>
              <td>{{ uplata.iznos|number_format }}</td>
              <td>{{ uplata.nacin_placanja }}</td>
			  <td>{{ uplata.opis }}</td>
			  <td class="text-right">
				<div class="btn-group btn-group-sm">
					<a href="" class="btn btn-warning">
						<i class="fas fa-edit"></i>
					</a>
					<a href="" class="btn btn-danger">
						<i class="fas fa-trash"></i>
					</a>
				</div>
			  </td>
            </tr>
            {% endfor %}
		  </tbody>
		  <tfoot>
			<tr class="bg-dark text-light">
              <th></th>
              <td>Zbir</td>
              <td>{{ ugovor.uplateSuma()|number_format }}</td>
              <td></td>
			  <td></td>
			  <td></td>
            </tr>
		  </tfoot>
        </table>
      </div>
</div>

{# Modal za evidentiranje uplate
<div id="uplataModal" class="modal fade" tabindex="-1" role="dialog">
<div class="modal-dialog" role="document">
	<div class="modal-content">
	<div class="modal-header">
		<h5 class="modal-title text-danger">Evidentiraj uplatu</h5>
		<button type="button" class="close" data-dismiss="modal" aria-label="Close">
		<span aria-hidden="true">&times;</span>
		</button>
	</div>
	<div class="modal-body">
		<form id="uplata-forma" action="{{ path_for('ugovor.uplata') }}" method="POST">
		{{ csrf|raw }}
		<input type="hidden" id="idUgovora" name="idUgovora">
		<div class="form-group">
			<label for="opis">Opis</label>
			<input type="text" class="form-control" name="opis" id="opis" aria-describedby="opis">
		</div>
		<div class="form-group">
			<label for="datum">Datum</label>
			<input name="datum" type="date" id="datum" class="form-control" value="{{ datum }}" />
			<small class="form-text{{ errors.datum[0] ? ' is-invalid' : '' }}">{{errors.datum[0]}}</small>
		</div>
		<div class="form-group">
			<label for="iznos">Iznos</label>
			<input type="number" class="form-control" name="iznos" id="iznos" min="0" step="0.01">
		</div>
		<div class="form-group">
			<label for="nacin_placanja">Način plaćanja:</label>
			<select class="custom-select mb-2" name="nacin_placanja" id="nacin_placanja" class="form-control">
			<option value=""></option>
			<option value="gotovina">Gotovina</option>
			<option value="kartica">Kartica</option>
			<option value="ček">Ček</option>
			<option value="faktura">Faktura</option>
			</select>
		</div>
		<hr style="margin-top: 30px;">
		<div class="row justify-content-end" style="margin-top: 30px; padding: 10px;">
			<div class="form-group">
			<a class="btn btn-outline-secondary" data-dismiss="modal">
				<i class="fas fa-ban"></i>&emsp;Otkaži
			</a>
			<button id="btn-brisanje-izmeni" type="submit" class="btn btn-outline-success">
				<i class="fas fa-plus-square"></i>&emsp;Evidentiraj
			</button>
			</div>
		</div>
		</form>
	</div>
	</div>
</div>
</div>
 Kraj modala za evidentiranje uplate #}
{% endblock sadrzaj %}
{% block traka %}
<div class="card border-dark mb-3">
    <div class="card-header">
		Detalji vezani za organizaciju
	</div>
    <div class="card-body text-dark">
      <div class="row">
      	<div class="col">
      		<table class="table table-sm table-striped" style="font-size: 0.875rem;">
      			<thead>
					<tr>
						<th class="w-5">#</th>
						<th class="w-20">Usluga</th>
						<th class="w-15 text-center">Status</th>
						<th class="w-60">Opis</th>
					</tr>
    			</thead>
					<tbody>
					<tr>
						<th>1</th>
						<td>Muzika</td>
						<td class="text-center">
							{{ (ugovor.muzika_chk == 1) ? '<i class=\"fas fa-check text-success\"></i>' : '' }}
						</td>
						<td>{{ ugovor.muzika_opis }}</td>
					</tr>
					<tr>
						<th>2</th>
						<td>Fotograf</td>
						<td class="text-center">
							{{ (ugovor.fotograf_chk == 1) ? '<i class=\"fas fa-check text-success\"></i>' : '' }}
						</td>
						<td>{{ ugovor.fotograf_opis }}</td>
					</tr>
					<tr>
						<th>3</th>
						<td>Torta</td>
						<td class="text-center">
							{{ (ugovor.torta_chk == 1) ? '<i class=\"fas fa-check text-success\"></i>' : '' }}
						</td>
						<td>{{ ugovor.torta_opis }}</td>
					</tr>
					<tr>
						<th>4</th>
						<td>Dekoracija</td>
						<td class="text-center">
							{{ (ugovor.dekoracija_chk == 1) ? '<i class=\"fas fa-check text-success\"></i>' : '' }}
						</td>
						<td>{{ ugovor.dekoracija_opis }}</td>
					</tr>
					<tr>
						<th>5</th>
						<td>Kokteli</td>
						<td class="text-center">
							{{ (ugovor.kokteli_chk == 1) ? '<i class=\"fas fa-check text-success\"></i>' : '' }}
						</td>
						<td>{{ ugovor.kokteli_opis }}</td>
					</tr>
					<tr>
						<th>6</th>
						<td>Slatki sto</td>
						<td class="text-center">
							{{ (ugovor.slatki_sto_chk == 1) ? '<i class=\"fas fa-check text-success\"></i>' : '' }}
						</td>
						<td>{{ ugovor.slatki_sto_opis }}</td>
					</tr>
					<tr>
						<th>7</th>
						<td>Voćni sto</td>
						<td class="text-center">
							{{ (ugovor.vocni_sto_chk == 1) ? '<i class=\"fas fa-check text-success\"></i>' : '' }}
						</td>
						<td>{{ ugovor.vocni_sto_opis }}</td>
					</tr>
					</tbody>
  				</table>
  			</div>
  		</div>
	</div>
</div>

<div class="card border-dark mb-3">
	<div class="card-header text-primary">
		Evidentiranje uplate
	</div>
	<div class="card-body text-dark">
		<form id="uplata-forma" action="{{ path_for('termin.ugovor.uplata') }}" method="POST">
			{{ csrf|raw }}
			<input type="hidden" id="idUgovora" name="ugovor_id" value="{{ ugovor.id }}">
			<div class="form-row">
				<div class="col form-group">
					<label for="opis">Opis</label>
					<input type="text" class="form-control" name="opis" id="opis" required>
				</div>
			</div>
			<div class="form-row">
				<div class="col form-group">
					<label for="datum">Datum</label>
					<input name="datum" type="date" id="datum" class="form-control" value="{{ old.datum ? : 'now'|date('Y-m-d') }}">
				</div>
				<div class="col form-group">
					<label for="nacin_placanja">Način plaćanja:</label>
					<select class="custom-select mb-2" name="nacin_placanja" id="nacin_placanja">
					<option value=""></option>
					<option value="gotovina">Gotovina</option>
					<option value="kartica">Kartica</option>
					<option value="ček">Ček</option>
					<option value="faktura">Faktura</option>
					</select>
				</div>
			</div>
			<div class="form-row">
				<div class="col form-group">
					<label for="iznos">Iznos</label>
					<input type="number" class="form-control" name="iznos" id="iznos" min="0" step="0.01">
				</div>
			</div>
			<div class="form-row">
				<div class="col form-group text-right mb-0">
					<button type="submit" class="btn btn-primary">
						<i class="fas fa-money-bill"></i> Evidentiraj uplatu
					</button>
					<button type="reset" class="btn btn-secondary">
						<i class="fas fa-ban"></i> Otkaži
					</button>
				</div>
			</div>
		</form>
	</div>
</div>

<div class="card border-dark mb-3">
	<div class="card-header">
		Zbirni finansijski podaci
	</div>
	<div class="card-body text-dark">
		<div class="row">
			<div class="col-lg-6">
				Ukupan iznos:
			</div>
			<div class="col-lg-6 text-primary text-right">
				<strong>{{ ugovor.iznos|number_format }}</strong>
			</div>
		</div>
		<div class="row">
			<div class="col-lg-6">
				Zbir uplata:
			</div>
			<div class="col-lg-6 text-success text-right">
				<strong>{{ ugovor.uplateSuma()|number_format }}</strong>
			</div>
		</div>
		<div class="row">
			<div class="col-lg-6">
				Dug po ugovoru:
			</div>
			<div class="col-lg-6 text-danger text-right">
				<strong>{{ ugovor.uplateDug()|number_format }}</strong>
			</div>
		</div>
	</div>
</div>
{% endblock traka %}
{% block skripta %}
  <script>
    $(document).ready(function () {
      $(document).on('click', '.otvori-uplatu', function () {
       var id = $(this).data("id");
        $('#idUgovora').val(id);
      });
    });
  </script>
{% endblock skripta %}
