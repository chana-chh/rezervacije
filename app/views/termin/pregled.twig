{% extends "templates/app.twig" %} {% block stil %}
<link href="{{ base_url() }}/css/fullcalendar.css" rel="stylesheet" />
<link
  href="{{ base_url() }}/css/fullcalendar.print.css"
  rel="stylesheet"
  media="print"
/>
<style>
  .fc-day-grid-event:hover {
    background-color: #c2e3ff !important;
    cursor: pointer;
  }
</style>
{% endblock stil %} {% block naslov %}
<div class="row">
  <div class="col-lg-6">
    <h1><i class="fas fa-calendar-check"></i> Zakazivanje termina</h1>
  </div>
  <div class="col-lg-6 text-right">
    <ul class="list-inline lead pt-3 mb-0">
      <li class="list-inline-item ml-4">
        <i class="fas fa-calendar-plus text-danger"></i> Termin u pripremi
      </li>
      <li class="list-inline-item ml-4">
        <i class="fas fa-calendar-check text-success"></i> Zaključen termin
      </li>
    </ul>
  </div>
</div>
<hr />
<div class="row">
  <div class="col-lg-12" id="kalendar"></div>
</div>
{% endblock naslov %} {% block skripta %}
<script src="{{ base_url() }}/js/moment.min.js"></script>
<script src="{{ base_url() }}/js/fullcalendar.min.js"></script>
<script src="{{ base_url() }}/js/sr.js"></script>

<script>
  $(document).ready(function() {
    $("#kalendar").fullCalendar({
      themeSystem: "bootstrap4",
      customButtons: {
        buttonStampa: {
          text: "Štampaj",
          click: function() {
            window.print();
          }
        }
      },
      header: {
        left: "buttonStampa",
        center: "title"
      },
      views: {
        month: {
          columnFormat: "dddd"
        }
      },
      defaultView: "month",
      weekends: true,
      height: 630,
      dayNames: [
        "nedelja",
        "ponedeljak",
        "utorak",
        "sreda",
        "četvrtak",
        "petak",
        "subota"
      ],
      dayNamesShort: [
        "nedelja",
        "ponedeljak",
        "utorak",
        "sreda",
        "četvrtak",
        "petak",
        "subota"
      ],
      monthNames: [
        "januar",
        "februar",
        "mart",
        "april",
        "maj",
        "jun",
        "jul",
        "avgust",
        "septembar",
        "oktobar",
        "novembar",
        "decembar"
      ],
      monthNamesShort: [
        "januar",
        "februar",
        "mart",
        "april",
        "maj",
        "jun",
        "jul",
        "avgust",
        "septembar",
        "oktobar",
        "novembar",
        "decembar"
      ],
      events: JSON.parse(`{{ data|raw }}`),
      eventBackgroundColor: "#e7f4ff",
      eventBorderColor: "#000000",
      eventTextColor: "#000000",
      eventRender: function(event, element, view) {
        // ovde dodam na element onclick za nesto (izmena termina, dodavanje ugovora ...)
        element.on("click", function() {
          alert(event.start.format("YYYY-MM-DD"));
        });
        let title = element.find(".fc-title");
        const html = `
        <div class="clearfix">
          <div class="float-left text-wrap">
            ${event.start.format("HH:mm")} - ${event.end.format("HH:mm")}
          </div>
          <div class="float-right">
            <i class="${event.description}"></i>
          </div>
        </div>
        <div class="text-wrap">
          ${event.title}
        </div>
        `;
        title.html(html);
        element.addClass("p-1");
      },
      dayClick: function(date, jsEvent, view) {
        // Pozivam unos termina sa datumom. Na termin rutu dodati datum kao argument
        // U dodavanju termina prebacim datum iz rute u datum input
        let loc = `{{ url_termin_dodavanje }}/${date.format()}`;
        window.location = loc;
      },
      displayEventTime: false
    });

    var cal = $("#kalendar").fullCalendar("getCalendar");
    // Citam poslednjih 10 karaktera iz trenutne rute
    var d = window.location.href.substr(-10);
    // Trazim crticu
    var crtica = d.search("-");
    // Ako postoji crtica onda je verovatno datum :)
    if (crtica !== -1) {
      // Pravim datum iz kalendarovog momenta
      var datum = cal.moment(d);
      // Teram kalendar na datum (vraca se na mesec odakle je unet termin)
      cal.gotoDate(datum);
      // Opciono selektujem datum
      // cal.select(datum);
    }
  });
</script>
{% endblock skripta %}
