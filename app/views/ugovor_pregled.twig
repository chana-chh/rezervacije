{% extends "templates/app.twig" %} 
{% block naslov %}
<div class="row mt-md-5">
  <div class="col">
    <h1>
      <i class="fas fa-file-signature text-secondary"></i> Pregled ugovora <span class="text-info"><strong>{{ugovor.broj_ugovora}}</strong></span>
    </h1>
  </div>
  <div class="col justify-content-end text-right">
    <div class="btn-group btn-group">
      <button type="button" class="btn btn-secondary btn-sm" onclick="window.history.back();" title="Povratak na prethodnu stranu"><i
          class="fas fa-chevron-circle-left"></i> Nazad</button>
      <a href="{{ path_for('ugovori') }}" class="btn btn-secondary btn-sm" title="Povratak na tabelarni prikaz ugovora"><i class="fas fa-file-signature"></i> SVI
        ugovori</a>
    </div>
  </div>
</div>
<hr />
{% endblock naslov %}
{% block sadrzaj %}
<div class="card border-dark mb-3">
  <div class="card-header text-warning"><h4>Termin: {{ugovor.termin().datum|date()}} od {{ ugovor.termin.pocetak|date("H:i") }} do {{ ugovor.termin.kraj|date("H:i") }}</h4></div>
  <div class="card-body text-dark">
  <table class="table table-sm">
      <tr style="font-size: 1.2em">
            <th style="width: 20%;"><strong>Meni:</strong></th>
            <td style="width: 70%;">{{ugovor.meni.naziv}}</td>
            <td style="width: 10%;"><a class="btn btn-info btn-sm" href="{{ path_for('meni.detalj', { id: ugovor.meni.id }) }}" title="Detaljni pregled odabranog menija"><i
              class="fas fa-eye"></i></a></td>
      </tr>
     <tr style="font-size: 1.2em">
            <th style="width: 20%;"><strong>Ime i prezime:</strong></th>
            <td style="width: 70%;">{{ugovor.punoIme()}}</td>
            <td style="width: 10%;"></td>
      </tr>
      <tr style="font-size: 1.2em">
            <th style="width: 20%;"><strong>Telefon:</strong></th>
            <td style="width: 70%;">{{ugovor.telefon}}</td>
            <td style="width: 10%;"></td>
      </tr>
      <tr style="font-size: 1.2em">
            <th style="width: 20%;"><strong>e-mail:</strong></th>
            <td style="width: 70%;">{{ugovor.email}}</td>
            <td style="width: 10%;"></td>
      </tr>
      <tr style="font-size: 1.2em">
            <th style="width: 20%;"><strong>Prosek godina:</strong></th>
            <td style="width: 70%;">{{ugovor.prosek_godina}}</td>
            <td style="width: 10%;"></td>
      </tr>
      <tr style="font-size: 1.2em">
            <th style="width: 20%;"><strong>Posebni zahtevi:</strong></th>
            <td style="width: 70%;">{{ugovor.posebni_zahtevi}}</td>
            <td style="width: 10%;"></td>
      </tr>
      <tr style="font-size: 1.2em">
            <th style="width: 20%;"><strong>Napomena:</strong></th>
            <td style="width: 70%;">{{ugovor.napomena}}</td>
            <td style="width: 10%;"></td>
      </tr>
  </table>
  </div>
</div>

 {# Modal za evidentiranje uplate #}
  <div id="uplataModal" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title text-danger">Evidentiraj uplatu</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="uplata-forma" action="{{ path_for('ugovor.uplata') }}" method="POST">
            {{ csrf|raw }}
            <input type="hidden" id="idUgovora" name="idUgovora">
            <div class="form-group">
              <label for="opis">Opis</label>
              <input type="text" class="form-control" name="opis" id="opis" aria-describedby="opis">
            </div>
            <div class="form-group">
              <label for="datum">Datum</label>
              <input name="datum" type="date" id="datum" class="form-control" value="{{ datum }}" />
              <small class="form-text{{ errors.datum[0] ? ' is-invalid' : '' }}">{{errors.datum[0]}}</small>
            </div>
            <div class="form-group">
              <label for="iznos">Iznos</label>
              <input type="number" class="form-control" name="iznos" id="iznos" min="0" step="0.01">
            </div>
            <div class="form-group">
              <label for="nacin_placanja">Način plaćanja:</label>
              <select class="custom-select mb-2" name="nacin_placanja" id="nacin_placanja" class="form-control"> 
              <option value=""></option>
              <option value="gotovina">Gotovina</option>
              <option value="kartica">Kartica</option>
              <option value="ček">Ček</option>
              <option value="faktura">Faktura</option>
              </select>
            </div>
            <hr style="margin-top: 30px;">
            <div class="row justify-content-end" style="margin-top: 30px; padding: 10px;">
              <div class="form-group">
                <a class="btn btn-outline-secondary" data-dismiss="modal">
                  <i class="fas fa-ban"></i>&emsp;Otkaži
                </a>
                <button id="btn-brisanje-izmeni" type="submit" class="btn btn-outline-success">
                  <i class="fas fa-plus-square"></i>&emsp;Evidentiraj
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  {# Kraj modala za evidentiranje uplate #}
{% endblock sadrzaj %}
{% block traka %}
  <div class="card border-dark mb-3">
    <div class="card-header">Detalji vezani za organizaciju</div>
    <div class="card-body text-dark">
       <div class="row">
        <h5 class="ml-3 text-warning">Pregled uslova</h5>
      </div>
      <div class="row">
      <div class="col-md-12">
      <table class="table table-sm table-striped" style="font-size: 0.75rem;">
      <thead>
      <tr>
        <th class="w-10" scope="col">#</th>
        <th class="w-25" scope="col">Usluga</th>
        <th class="w-25 text-center" scope="col">Status</th>
        <th class="w-40" scope="col">Opis</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <th scope="row">1</th>
        <td><strong>Muzika</strong></td>
        <td class="text-center">{{ (ugovor.muzika_chk == 1) ? '<i class=\"fas fa-check fa-lg text-success\"></i>' : '' }}</td>
        <td>{{ ugovor.muzika_opis }}</td>
      </tr>
      <tr>
        <th scope="row">2</th>
        <td><strong>Fotograf</strong></td>
        <td class="text-center">{{ (ugovor.fotograf_chk == 1) ? '<i class=\"fas fa-check fa-lg text-success\"></i>' : '' }}</td>
        <td>{{ ugovor.fotograf_opis }}</td>
      </tr>
      <tr>
        <th scope="row">3</th>
        <td><strong>Torta</strong></td>
        <td class="text-center">{{ (ugovor.torta_chk == 1) ? '<i class=\"fas fa-check fa-lg text-success\"></i>' : '' }}</td>
        <td>{{ ugovor.torta_opis }}</td>
      </tr>
      <tr>
        <th scope="row">4</th>
        <td><strong>Dekoracija</strong></td>
        <td class="text-center">{{ (ugovor.dekoracija_chk == 1) ? '<i class=\"fas fa-check fa-lg text-success\"></i>' : '' }}</td>
        <td>{{ ugovor.dekoracija_opis }}</td>
      </tr>
      <tr>
        <th scope="row">5</th>
        <td><strong>Kokteli</strong></td>
        <td class="text-center">{{ (ugovor.kokteli_chk == 1) ? '<i class=\"fas fa-check fa-lg text-success\"></i>' : '' }}</td>
        <td>{{ ugovor.kokteli_opis }}</td>
      </tr>
      <tr>
        <th scope="row">6</th>
        <td><strong>Slatki sto</strong></td>
        <td class="text-center">{{ (ugovor.slatki_sto_chk == 1) ? '<i class=\"fas fa-check fa-lg text-success\"></i>' : '' }}</td>
        <td>{{ ugovor.slatki_sto_opis }}</td>
      </tr>
      <tr>
        <th scope="row">7</th>
        <td><strong>Voćni sto</strong></td>
        <td class="text-center">{{ (ugovor.vocni_sto_chk == 1) ? '<i class=\"fas fa-check fa-lg text-success\"></i>' : '' }}</td>
        <td>{{ ugovor.vocni_sto_opis }}</td>
      </tr>
    </tbody>
  </table>
  </div>
  </div>
  <hr>
  <div class="row">
        <h5 class="ml-3 text-warning">Pregled uplata</h5>
  </div>
  <div class="row">
      <div class="col-md-12">
        <table class="table table-sm" style="font-size: 0.75rem;">
          <thead class="thead-dark">
            <tr>
              <th class="w-5" scope="col">#</th>
              <th class="w-25" scope="col">Datum</th>
              <th class="w-25" scope="col">Iznos</th>
              <th class="w-25" scope="col">Način plaćanja</th>
              <th class="w-20" scope="col">Opis</th>
            </tr>
          </thead>
          <tbody>
            {% for uplata in ugovor.uplate %}
            <tr>
              <th scope="row">{{ loop.index }}</th>
              <td><strong>{{ uplata.datum|date() }}</strong></td>
              <td>{{ uplata.iznos| number_format(2, '.', ',') }}</td>
              <td>{{ uplata.nacin_placanja }}</td>
              <td>{{ uplata.opis }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
  </div>
  <div class="row bg-light text-right">
      <div class="col-md-5">
        <h5>Suma uplata: <span class="text-success">{{ ugovor.uplateSuma()| number_format(2, '.', ',') }}</span> </h5>
      </div>
      <div class="col-md-2">
        
      </div>
      <div class="col-md-5">
        <h5>Dug po ugovoru: <span class="text-danger">{{ ugovor.uplateDug()| number_format(2, '.', ',') }}</span> </h5>
      </div>
    </div>
    <div class="row mt-1">
       <div class="col-md-12 text-right">
          <button class="btn btn-outline-success btn-sm otvori-uplatu" data-toggle="modal" data-target="#uplataModal"
            data-id="{{ ugovor.id }}" title="Evidetiranje uplate"><i class="fas fa-plus-square"></i> Evidetiranje uplate</button>
       </div>
    </div>
    </div>
  </div>
{% endblock traka %}
{% block skripta %}
  <script>
    $(document).ready(function () {

      $(document).on('click', '.otvori-uplatu', function () {

       var id = $(this).data("id");
        $('#idUgovora').val(id);

      });

    });
  </script>
{% endblock skripta %}